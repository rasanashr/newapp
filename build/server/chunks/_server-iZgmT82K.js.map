{"version":3,"file":"_server-iZgmT82K.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/ai/analyze/_server.js"],"sourcesContent":["import { p as private_env } from \"../../../../../chunks/shared-server.js\";\nimport { j as json } from \"../../../../../chunks/index.js\";\nasync function POST({ request }) {\n  try {\n    const { title, content } = await request.json();\n    console.log(\"üöÄ Initiating OpenAI request for analysis...\");\n    console.log(`API Key starts with: ${private_env.OPENAI_API_KEY.substring(0, 5)}...`);\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 3e4);\n    const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": `Bearer ${private_env.OPENAI_API_KEY}`\n      },\n      body: JSON.stringify({\n        model: \"gpt-4\",\n        messages: [{\n          role: \"system\",\n          content: \"You are a professional news analyst. Provide a detailed analysis of the news content in Persian language. Focus on implications, context, and potential impacts.\"\n        }, {\n          role: \"user\",\n          content: `ÿπŸÜŸàÿßŸÜ ÿÆÿ®ÿ±: ${title}\n\nŸÖÿ™ŸÜ ÿÆÿ®ÿ±: ${content}\n\nŸÑÿ∑ŸÅÿß ÿß€åŸÜ ÿÆÿ®ÿ± ÿ±ÿß ÿ™ÿ≠ŸÑ€åŸÑ ⁄©ŸÜ€åÿØ.`\n        }]\n      }),\n      signal: controller.signal\n    });\n    clearTimeout(timeoutId);\n    if (!response.ok) {\n      console.error(`OpenAI API responded with status: ${response.status}`);\n      const errorData = await response.text();\n      console.error(\"Error response:\", errorData);\n      throw new Error(`OpenAI API responded with status: ${response.status}`);\n    }\n    console.log(\"‚úÖ Successfully received response from OpenAI\");\n    const data = await response.json();\n    if (!data.choices || !data.choices[0] || !data.choices[0].message) {\n      console.error(\"Unexpected response structure:\", data);\n      throw new Error(\"Unexpected response structure from OpenAI\");\n    }\n    console.log(\"‚úÖ Successfully parsed response\");\n    return json({ result: data.choices[0].message.content });\n  } catch (error) {\n    console.error(\"‚ùå Error in analysis process:\", error);\n    if (error.name === \"AbortError\") {\n      return json({\n        error: \"ÿØÿ±ÿÆŸàÿßÿ≥ÿ™ ÿ®Ÿá ÿØŸÑ€åŸÑ ÿ™ÿß€åŸÖ‚ÄåÿßŸàÿ™ ŸÑÿ∫Ÿà ÿ¥ÿØ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.\"\n      }, { status: 408 });\n    }\n    return json({\n      error: \"ŸÖÿ™ÿ£ÿ≥ŸÅÿßŸÜŸá ÿØÿ± ÿ™ÿ≠ŸÑ€åŸÑ ÿÆÿ®ÿ± ÿÆÿ∑ÿß€å€å ÿ±ÿÆ ÿØÿßÿØ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.\"\n    }, { status: 500 });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}