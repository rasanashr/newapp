const r="v1",h=`rasanashr-cache-${r}`,i=["/","/offline","/manifest.json","/favicon.png","/logo.svg"];self.addEventListener("install",e=>{e.waitUntil(caches.open(h).then(t=>t.addAll(i)))});self.addEventListener("fetch",e=>{const{request:t}=e;if(t.method==="GET"){if(t.url.startsWith("https://rooidadha.ir/wp-json/wp/v2 ")){e.respondWith(caches.match(t).then(c=>{const n=fetch(t).then(a=>{if(!a.ok)throw new Error("Network response not OK");return caches.open(h).then(s=>{s.put(t,a.clone())}),a});return c||n.catch(()=>caches.match("/offline"))}));return}if(t.headers.get("Accept").includes("text/html")){e.respondWith(fetch(t).catch(()=>caches.match(t)).then(c=>c||caches.match("/offline")));return}if(t.destination==="image"){e.respondWith(caches.match(t).then(c=>c||fetch(t).then(n=>(n.ok&&caches.open(h).then(a=>{a.put(t,n.clone())}),n))));return}e.respondWith(caches.match(t).then(c=>c||fetch(t)))}});self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(t=>Promise.all(t.filter(c=>c!==h).map(c=>caches.delete(c))))),self.clients.claim()});self.addEventListener("message",e=>{e.data&&e.data.type==="SKIP_WAITING"&&self.skipWaiting()});
